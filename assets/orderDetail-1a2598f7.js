import{b as w,A as L,d as R,u as T,s as q,r as x,Z as G,$ as X,x as Z,o as s,c as o,a as t,h as i,y as A,w as C,e as n,t as l,F as f,k as _,a0 as J,Y as Q,a1 as P,I as W,f as I,j as N,S as K,X as ee,i as H,a2 as te,a3 as ae}from"./index-338f6742.js";import{u as se}from"./useLoading-d20fdbfd.js";import{l as B}from"./lodash-a2725ec0.js";var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"};const ne=oe;function M(p){for(var u=1;u<arguments.length;u++){var d=arguments[u]!=null?Object(arguments[u]):{},v=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(d).filter(function(h){return Object.getOwnPropertyDescriptor(d,h).enumerable}))),v.forEach(function(h){le(p,h,d[h])})}return p}function le(p,u,d){return u in p?Object.defineProperty(p,u,{value:d,enumerable:!0,configurable:!0,writable:!0}):p[u]=d,p}var j=function(u,d){var v=M({},u,d.attrs);return w(L,M({},v,{icon:ne}),null)};j.displayName="CreditCardOutlined";j.inheritAttrs=!1;const de=j,ce={class:"mb-[15px]"},ie=t("div",{class:"ml-[5px]"},"返回",-1),re={class:"shadow-md bg-white rounded-md border p-[15px] overflow-hidden"},ue={class:"flex items-center justify-between border-b pb-[10px] mb-[10px]"},_e=t("div",{class:"font-bold text-lg"},"商品信息",-1),ve={class:"flex items-center gap-x-2"},fe={class:""},pe={class:"lg:px-10 pt-10"},he={class:"flex justify-between"},me={class:"text-2xl font-bold"},xe={key:0,class:"text-[#c41e7f]"},ye={key:1,class:"text-[#d01423]"},ge={key:2,class:"text-[#ffd591]"},be={key:3,class:"text-[#379e0e]"},ke={key:4,class:"text-[#0b979d]"},Ce=t("div",{class:"text-2xl font-bold text-end"},"订单号 #",-1),we={class:"text-end mt-2 text-[#999]"},Oe={class:"mt-4"},Fe={key:0,class:"font-bold text-lg"},Ye={class:"mt-3"},Pe=t("span",{class:"mr-3"},"周期:",-1),je={class:"font-bold"},De={class:"mt-3"},Ae=t("span",{class:"mr-3"},"流量:",-1),Ie={key:0,class:"font-bold"},Ne={class:"mt-3"},He=t("span",{class:"mr-3"},"价格:",-1),Be={key:0,class:"font-bold"},Me={key:1,class:"font-bold"},Se={class:"mt-8"},Ve={class:"flex flex-col items-end"},ze={class:"flex"},Ee=t("span",{class:"text-[#999] mr-4"},"创建时间:",-1),Ue={class:"font-bold"},$e={class:"flex mt-3"},Le=t("span",{class:"text-[#999] mr-4"},"更新时间:",-1),Re={class:"font-bold"},Te={class:"grid grid-cols-1 lg:grid-cols-2"},qe={key:0,class:"shadow-md bg-white rounded-md border p-[15px] mt-5 overflow-hidden"},Ge=t("div",{class:"font-bold text-lg border-b pb-[10px] mb-[10px] ]"},"支付方式",-1),Xe={class:"flex items-center justify-center py-2"},Ze=["src"],Je={class:"ml-3"},Qe={class:"lg:px-10"},We={class:"mt-8 flex flex-col items-end"},Ke={key:0,class:"font-bold flex items-center"},et=t("div",{class:"text-[#999] flex-1"},"手续费:",-1),tt={class:"text-xl w-[120px] text-end"},at={key:1,class:"font-bold flex mt-2 items-center"},st=t("div",{class:"text-[#999] flex-1"},"折扣:",-1),ot={class:"text-xl w-[120px] text-end"},nt={key:2,class:"font-bold flex mt-2 items-center"},lt=t("div",{class:"text-[#999] flex-1"},"余额支付:",-1),dt={class:"text-xl w-[120px] text-end"},ct={class:"font-bold mt-2 flex items-center"},it=t("div",{class:"text-[#999] flex-1"},"账单金额:",-1),rt={class:"text-2xl text-[#f33d30] w-[120px] text-end"},ft=R({__name:"orderDetail",setup(p){const u=T(),{getCommConfig:d}=q(u),v=x(""),h=x([]),{setLoading:Y}=se(),e=x({});let r=null;const O=x(!1),F=x(!1);function D(){return N.currentRoute.value.params.id}function S(){r&&(clearInterval(r),r=null),r=setInterval(async()=>{const a=await ae({trade_no:D()});if(a.data!=0&&(r&&clearInterval(r),a.data.trade_no)){const c=await P({trade_no:a.data.trade_no});e.value=c.data}},1500)}G(()=>{r&&(clearInterval(r),r=null)}),X(()=>{r&&(clearInterval(r),r=null)});async function V(){try{Y(!0);const a=await P({trade_no:D()});e.value=a.data,a.data.status==0&&(await E(),S()),Y(!1)}catch(a){Y(!1),console.log(a)}}const m=x({}),y=x(null);function z(a){if(B.forEach(h.value,c=>{c.value==a&&(m.value=c.payload)}),m.value.handling_fee_fixed||m.value.handling_fee_percent){const c=parseFloat(e.value.total_amount)/100,g=parseFloat(m.value.handling_fee_percent)/100,k=m.value.handling_fee_fixed?parseFloat(m.value.handling_fee_fixed)/100:0;y.value=c*g+k}}async function E(){try{const a=await te();if(h.value=B.map(a.data,c=>({value:c.id,payload:c})),v.value=a.data[0].id,m.value=a.data[0],a.data[0].handling_fee_fixed||a.data[0].handling_fee_percent){const c=parseFloat(e.value.total_amount)/100,g=parseFloat(a.data[0].handling_fee_percent)/100,k=a.data[0].handling_fee_fixed?parseFloat(a.data[0].handling_fee_fixed)/100:0;y.value=c*g+k}}catch(a){console.log(a)}}async function U(){try{F.value=!0;const a=await J({trade_no:e.value.trade_no,method:v.value});F.value=!1,a.data===!0?window.location.reload():typeof a.data=="string"&&(window.location.href=a.data)}catch(a){F.value=!1,console.log(a)}}async function $(){try{r&&(clearInterval(r),r=null),O.value=!0,await Q({trade_no:e.value.trade_no});const a=await P({trade_no:e.value.trade_no});e.value=a.data,O.value=!1,W.success("订单已取消")}catch(a){O.value=!1,console.log(a)}}return Z(()=>{V()}),(a,c)=>{const g=I("a-button"),k=I("a-segmented");return s(),o("div",null,[t("div",ce,[t("div",{class:"lg:hidden flex items-center cursor-pointer",onClick:c[0]||(c[0]=b=>i(N).back())},[w(i(K)),ie])]),t("div",re,[t("div",ue,[_e,t("div",ve,[e.value.status<2?(s(),A(g,{key:0,loading:O.value,onClick:$},{icon:C(()=>[w(i(ee))]),default:C(()=>[_("关闭订单 ")]),_:1},8,["loading"])):n("",!0),e.value.status==0?(s(),A(g,{key:1,loading:F.value,onClick:U,type:"primary"},{icon:C(()=>[w(i(de))]),default:C(()=>[_("支付订单 ")]),_:1},8,["loading"])):n("",!0)])]),t("div",fe,[t("div",pe,[t("div",he,[t("div",me,[e.value.status==0?(s(),o("div",xe,"待支付")):n("",!0),e.value.status==1?(s(),o("div",ye,"开通中")):n("",!0),e.value.status==2?(s(),o("div",ge,"已取消")):n("",!0),e.value.status==3?(s(),o("div",be,"已完成")):n("",!0),e.value.status==4?(s(),o("div",ke,"已折抵")):n("",!0)]),t("div",null,[Ce,t("div",we,l(e.value.trade_no),1)])]),t("div",Oe,[e.value.plan?(s(),o("div",Fe,l(e.value.plan.name),1)):n("",!0),t("div",Ye,[Pe,t("span",je,[e.value.period=="month_price"?(s(),o(f,{key:0},[_("月付")],64)):n("",!0),e.value.period=="quarter_price"?(s(),o(f,{key:1},[_("季付")],64)):n("",!0),e.value.period=="half_year_price"?(s(),o(f,{key:2},[_("半年付")],64)):n("",!0),e.value.period=="year_price"?(s(),o(f,{key:3},[_("年付")],64)):n("",!0),e.value.period=="two_year_price"?(s(),o(f,{key:4},[_("两年付")],64)):n("",!0),e.value.period=="three_year_price"?(s(),o(f,{key:5},[_("三年付")],64)):n("",!0),e.value.period=="onetime_price"?(s(),o(f,{key:6},[_("一次性付")],64)):n("",!0),e.value.period=="reset_price"?(s(),o(f,{key:7},[_("流量重置包")],64)):n("",!0)])]),t("div",De,[Ae,e.value.plan?(s(),o("span",Ie,l(e.value.plan&&e.value.plan.transfer_enable?e.value.plan.transfer_enable:"0")+" GB",1)):n("",!0)]),t("div",Ne,[He,e.value.plan?(s(),o("span",Be,[e.value.period=="reset_price"?(s(),o(f,{key:0},[_(l(i(d).currency_symbol||"¥")+" "+l(e.value.plan.reset_price?(e.value.plan.reset_price/100).toFixed(2):"0.00")+" "+l(i(d).currency||"CNY"),1)],64)):(s(),o(f,{key:1},[_(l(i(d).currency_symbol||"¥")+" "+l(e.value.plan.month_price?(e.value.plan.month_price/100).toFixed(2):"0.00")+" "+l(i(d).currency||"CNY"),1)],64))])):(s(),o("span",Me,l(i(d).currency_symbol||"¥")+" 0.00 "+l(i(d).currency||"CNY"),1))])]),t("div",Se,[t("div",Ve,[t("div",ze,[Ee,t("span",Ue,l(i(H).unix(e.value.created_at).format("YYYY-MM-DD HH:mm:ss")),1)]),t("div",$e,[Le,t("span",Re,l(i(H).unix(e.value.updated_at).format("YYYY-MM-DD HH:mm:ss")),1)])])])])])]),t("div",Te,[t("div",null,[e.value.status==0?(s(),o("div",qe,[Ge,t("div",null,[w(k,{value:v.value,"onUpdate:value":c[1]||(c[1]=b=>v.value=b),options:h.value,block:"",onChange:z},{label:C(({payload:b={}})=>[t("div",Xe,[b.icon?(s(),o("img",{key:0,src:b.icon,alt:"",class:"h-[25px]"},null,8,Ze)):n("",!0),t("div",Je,l(b.name),1)])]),_:1},8,["value","options"])])])):n("",!0)]),t("div",Qe,[t("div",We,[y.value?(s(),o("div",Ke,[et,t("div",tt,"+"+l(i(d).currency_symbol||"¥")+" "+l(y.value),1)])):n("",!0),e.value.discount_amount?(s(),o("div",at,[st,t("div",ot," -"+l(i(d).currency_symbol||"¥")+" "+l(e.value.discount_amount?(e.value.discount_amount/100).toFixed(2):"0.00"),1)])):n("",!0),e.value.discount_amount?(s(),o("div",nt,[lt,t("div",dt," -"+l(i(d).currency_symbol||"¥")+" "+l(e.value.balance_amount?(e.value.balance_amount/100).toFixed(2):"0.00"),1)])):n("",!0),t("div",ct,[it,t("div",rt,l(e.value.total_amount?(e.value.total_amount/100+(y.value?parseFloat(y.value):0)).toFixed(2):"0.00")+" "+l(i(d).currency||"CNY"),1)])])])])])}}});export{ft as default};
